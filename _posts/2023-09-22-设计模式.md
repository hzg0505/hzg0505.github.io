---
title: 设计模式
date: 2023-09-22 15:30:00 +0800
categories: [学习笔记, 设计模式]
# toc: false
tags: [c++, 设计模式]     # TAG names should always be lowercase
---



# 设计模式

### 1. 设计模式是什么

- 设计模式是指在软件开发中，经过验证的，用于解决在特定环境下，重复出现的，特定问题的解决方案
- 解决问题的固定套路
- 慎用设计模式
  - 一般c++中3-4个就很多了

### 2. 设计模式解决什么问题

- 前提：具体需求即有稳定点，又有变化点
  - 稳定点：未来不需要反复修改
  - 变化点：未来需要修改（全是变化点，用脚本语言）

- 希望**修改少量代码**就可以适应需求的变化

- 类比：
  - 整洁的房间，好动的猫，如何保持房间整洁
    - 将猫关进笼子里
  - 稳定点，变化点，

### 3. 策略模式

- 定义：定义一系列算法，把它们一个个封装起来，并且使他们可互相替换。（该模式使得**算法可以独立与使用它的客户程序而变化**）
- 解决了什么问题
  - 稳定点：客户程序和**调用**算法的**关系**
    - 切换接口
    - 选择调用接口
  - 变化点：
    - 新增算法
    - 算法内容发生变化
    - 切换算法
- 代码结构
  - 算法接口（隔离变化 => 接口隔离原则）
    - 客户程序只依赖具体的接口，不依赖具体的实现
  - 算法的具体实现
  - 算法调用者
    - 组合算法接口指针
    - 依赖注入：选择切换算法
- 扩展代码
  - 新增
    - 继承算法接口
    - 新增算法实现
    - 依赖注入选择具体算法
  - 修改
    - 继承原策略接口
    - 写具体实现
    - 依赖注入选择具体算法
- 案例
  - 日志系统（容错机制）
    - 数据传输策略
      - 写入 db  (可能连接会断开)
      - 写入 磁盘
      - 写入 kafka  => db
    - 客户程序（定义了一个接口 write）
      - 默认写db
      - db断开，重试几次，未成功写磁盘
      - 磁盘io压力大，往kafka记录数据

### 4. 观察者模式

- 定义：定义对象见的一种一对多的依赖关系，一个对象发生变化，多个观察者观察目标对象的变化得到通知自动更新
  - 一个对象，多个观察者，（多个观察者依赖一个对象）
- 解决了什么问题
  - 稳定点：一对多的依赖关系是稳定的
  - 变化点：观察者数量的变化
    - 观察者增加
    - 观察者减少
- 代码结构
  - 观察者接口：接口隔离
  - 实现不同的观察者，
  - 目标对象
    - 需要通过单例实现
    - 容器接受不同的观察者 （接口指针）
    - 依赖注入

- 扩展代码
  - 观察者增加
    - 继承观察者接口
    - 实现观察者跟着变化的逻辑
    - 接口调用
  - 观察者减少
    - 接口释放掉

- 应用案例
  - 用户对象不同等级或VIP用户具有不同的权限和特定的接口
    - 有多个系统模块
    - 利用接口隔离用户对象和其他系统模块

### 5. 责任链模式

- 定义：多个对象都有机会处理请求，从而避免请求发送者和接受者之间的耦合关系。将这些对象连成一条链，并沿着这条链传递请求，直到有对象处理为止。
- 解决了什么问题
  - 稳定点
    - 请求按照链表传递
      - 链表
      - 会打断（中止）：处理完成即终止
  - 变化点
    - 处理节点个数和顺序可能变化
    - 处理逻辑
      - 处理方式
      - 处理条件
- 代码结构
  - 抽象一个节点（统一的节点）
    - 组合基类指针
    - next指针
    - 这个节点如何处理，什么条件下传递给下一个节点
  - 一个链表结构
  - 链表传递流程
    - 如何传递的（根据需求改变）
    - 什么条件打断
  - 如何增加节点
    - 继承统一的节点，实现步骤流程
- **设计原则**
  - 单一职责原则
  - 修改关闭，扩展开放
    - 虚函数覆盖修改方法扩展
    - 组合基类指针进行扩展
- 应用案例
  - 请假流程
    - 程序审批  （1）
    - 导师审批   （>3 ）
    - 导员审批   （>7）
    - 学院学工处审批（> 1个月）
  - nginx
    - http 11 个阶段处理

### 6. 模版模式

- 定义：定义了算法的骨架，而将一些步骤延迟到子类中实现。（子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤）
- 解决了什么问题
  - 稳定点：
    - 算法的骨架是稳定的（需要哪些步骤）
  - 变化点
    - 步骤实现方式可以变化
- 代码结构
  - 一个统一接口：实现算法骨架（流程）
  - 虚函数覆盖：protected 限定扩展的接口，用 virtual 限定
  - 调用：基类指针，new一个迭代（新）的版本的对象 =》 多态
- 设计原则
  - 最小知道原则
  - 单一职责原则
  - 接口隔离原则
  - 封装、继承、多态
  - 里氏替换原则
  - 开闭原则（不修改原有类，虚函数覆盖修改方法）
- 扩展代码
  - 继承基类，虚函数覆盖
- 应用案例
  - 某个品牌动物园，有一套固定的表演流程
    - 若干个字流程可创新替换

### 7. 组合模式

- 定义：将对象组合成树型结构以表示“部分-整体”的层次结构。组合模式使得用户对单个对象和组合对象的使用具有一致性。
- 稳定点
  - 部分-整体结构关系
- 代码结构
  - 容器节点
  - 叶子结点
- 应用案例
  - 游戏开发中



### 8. 过滤器

### 9. 工厂

### 10. 单例
