---
title: 线程池
date: 2023-09-25 15:30:00 +0800
categories: [学习笔记, 线程池]
# toc: false
tags: [c++, 线程池, thread]     # TAG names should always be lowercase
---

# 线程池

### 1. 用途

- 场景
  - 某些任务十分耗时，影响该线程处理其他任务
  - 异步执行
    - 上下文
    - 任务执行函数
- 作用
  - 复用线程资源
  - 充分利用系统资源
  - 异步执行耗时任务

- 案例
  - 写日志

### 2. 如何实现线程池

- 什么是线程池
  - 线程池是一个生产消费模型
  - 线程池数量
    - 什么类型的任务
      - cpu密集型任务
        - cpu核心数
      - io密集型任务
        - 2*cpu核心数 + 2
    - cpu核心数
    - 公式：（io等待时间 + cpu运算时间）* 核心数 / cpu运算时间
  - 线程池构成
    - 线程（生产者）  => 发布任务
    - 队列  => 存储任务
      - 任务上下文
      - 任务执行函数
    - 线程池（消费者） => 处理任务
      - 取出任务
      - 执行任务
      - 线程调度
        - 从无到有 （发布任务，由生产者发布）
        - 从有到无
        - mutex + condition
- 实现一个线程池
  - 接口设计
    - 创建线程池
      - 线程池数量
      - 队列长度
    - 销毁线程池
      - 标记线程池退出
      - 通知所有线程
        - 休眠的
          - 唤醒
        - 正在执行的
    - 发出任务
      - 构建任务
      - 加入任务队列
        - 加锁
      - 唤醒一个休眠的线程
  - 数据结构设计

- 任务队列
  - 回调函数
  - 参数
- 执行队列
  - id
  - flag（任务能不能工作）
  - 堆栈大小
  - sigmask：每个线程都有自己的私有空间
- 管理组件
  - 