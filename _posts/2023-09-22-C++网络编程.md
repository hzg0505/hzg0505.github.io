---
title: C++ 网络编程
date: 2023-09-21 15:30:00 +0800
categories: [学习笔记, C++]
# toc: false
tags: [c++, 网络编程, socket]     # TAG names should always be lowercase
---





![image-20230922093424856](/assets/figs/c++网络编程/image-20230922093424856.png)

# 网络编程

### 一、做什么

#### 1. 网络编程关注内容

- 连接的建立
  - client
    - 作为客户端连接第三方服务
  - server
    - 接收客户端的连接
- 连接的断开
  - client
    - 主动断开连接
  - server
    - 被动断开连接
- 消息的到达
  - read直接检测消息是否到达
  - io多路复用去检测消息是否到达，read函数
- 消息发送完毕
  - write 直接检测是否可以将数据发送
  - io多路复用去检测，write函数将数据发送出去

![image-20230922095641830](/assets/figs/c++网络编程/image-20230922095641830.png)

### 二、读写 read/write

#### 1. 读写缓存区

- 每个连接都有读写缓存区
  - 应用程序向系统内核获取数据
    - 准备数据：内核准备好数据
    - 拷贝数据：将准备好的数据拷贝到buffer中
- **阻塞io模型**和**非阻塞io模型**
  - 数据未准备好时，
    - 阻塞io模型持续等待（处于阻塞状态）
    - 非阻塞io模型立刻返回
  - 数据未拷贝完是
    - 阻塞io模型和非阻塞io模型均需等待（处于阻塞状态）

#### 2. 阻塞io模型 + 多线程

- 每一个线程处理一个fd链接 block io
- 优点
  - 及时处理
- 缺点
  - 线程利用率低，线程数量有限

### 三、 io多路复用

![image-20230922105829198](/assets/figs/c++网络编程/image-20230922105829198.png)

> 使用io多路复用，read/write 不用直接去检测是否准备好了数据，只需在准备好时进行系统调用即可

> io多路复用 主要作用 将io处理转化为事件处理

#### 1. epoll

![image-20230922112058383](/assets/figs/c++网络编程/image-20230922112058383.png)

- epoll_ctl 

  - 在数据结构（红黑树）中注册一个事件（读/写）
    - 红黑树中每个节点对应一个 fd

- epoll_create

  - 有多个节点（fd）
  - 数据准备好，将数据拷贝到就绪队列（双端队列）

- epoll_wait

  - 将就绪队列的数据拷贝到用户空间
  - 中间还是有阻塞状态

  